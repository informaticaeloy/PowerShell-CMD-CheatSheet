
Write-Host "`n===== RESUMEN DE PERMISOS EN BUZONES =====" -ForegroundColor White

if ($resultados.Count -gt 0) {
    $ultimoBuzon = ""
    $colorSwitch = $true

    foreach ($entry in $resultados) {
        if ($entry."Buzón" -ne $ultimoBuzon) {
            # Cambiar color cada vez que cambia de buzón
            $colorSwitch = -not $colorSwitch
            $ultimoBuzon = $entry."Buzón"
            Write-Host "`nBuzón: $($entry."Buzón")" -ForegroundColor Yellow -BackgroundColor DarkBlue
        }

        if ($colorSwitch) {
            Write-Host ("   Usuario: {0} | Acceso: {1} | Denegado: {2} | Heredado: {3}" -f `
                $entry."Usuario con permisos", $entry."Tipo de acceso", $entry."¿Es denegado?", $entry."¿Hereda permisos?") `
                -ForegroundColor White -BackgroundColor DarkGreen
        }
        else {
            Write-Host ("   Usuario: {0} | Acceso: {1} | Denegado: {2} | Heredado: {3}" -f `
                $entry."Usuario con permisos", $entry."Tipo de acceso", $entry."¿Es denegado?", $entry."¿Hereda permisos?") `
                -ForegroundColor White -BackgroundColor DarkCyan
        }
    }
} else {
    Write-Host "No se encontraron permisos adicionales en ningún buzón." -ForegroundColor Red
}
